install.packages(c("ggraph", "mongolite", "pagedown", "pmml", "yardstick"))
remotes::install_github(("RamiKrispin/coronavirus"))
library(tidyverse)
coronavirus <- coronavirus::coronavirus
ggplot(coronavirus %>%
filter(Country.Region %in% c("France", "Italy", "Germany", "China", "Spain")) %>%
group_by(Country.Region, type, date) %>%
summarize(cases = sum(cases)) %>%
ungroup(),
aes(x = date, y = cases, color = Country.Region, linetype = type)) +
geom_line() +
scale_y_continuous(trans = "pseudo_log")
ggplot(coronavirus %>%
filter(Country.Region %in% c("France", "Italy", "Germany", "China", "Spain")) %>%
group_by(Country.Region, type, date) %>%
summarize(cases = sum(cases)) %>%
mutate(cases = cumsum(cases)) %>%
ungroup(),
aes(x = date, y = cases, color = Country.Region, linetype = type)) +
geom_line() +
scale_y_continuous(trans = "pseudo_log")
plot_ratio <- function(country = "Italy", delta_day = 9, country_ref = "France") {
if (delta_day >= 0) {
delta_fn <- lead
delta_str <- "lead"
} else {
delta_fn <- lag
delta_str <- "lag"
delta_day <- -delta_day
}
ggplot(coronavirus %>%
filter(Country.Region %in% c(country_ref, country)) %>%
group_by(Country.Region, type, date) %>%
summarize(cases = sum(cases)) %>%
mutate(cases = cumsum(cases)) %>%
ungroup() %>%
pivot_wider(names_from = Country.Region,
values_from = cases) %>%
mutate(ratio = .data[[country]] / delta_fn(.data[[country_ref]], delta_day)),
aes(x = date, y = ratio, linetype = type)) +
geom_line() +
geom_hline(yintercept = 1) +
labs(title = glue::glue("Ratio: {country}/{country_ref} with a {delta_str} for {country} of {delta_day} day(s)"))
}
plot_ratio()
plot_ratio("France", 1, "Spain")
plot_ratio("Spain", -1) + scale_y_continuous(limits = c(0, 15))
plot_ratio("China", 45) + scale_y_continuous(limits = c(0, 25))
plot_ratio("China", 46)
plot_ratio("France", -46, "China")
plot_ratio("China", 35, "Italy") + scale_y_continuous(limits = c(0, 25))
plot_ratio("Italy", -37, "China")
ggplot(coronavirus %>%
filter(Country.Region %in% c("France", "Italy", "Germany", "Spain"),
type != "recovered") %>%
group_by(Country.Region, type, date) %>%
summarize(cases = sum(cases)) %>%
mutate(cases = cumsum(cases),
growth = cases/lag(cases)) %>%
ungroup(),
aes(x = date, y = growth, color = Country.Region, linetype = type)) +
geom_smooth() +
facet_wrap(vars(Country.Region)) +
coord_cartesian(ylim = c(.5, 2.5))
ggplot(coronavirus %>%
filter(Country.Region %in% c("France", "Italy", "Germany", "Spain"),
type != "recovered") %>%
group_by(Country.Region, type, date) %>%
summarize(cases = sum(cases)) %>%
mutate(cases = cumsum(cases),
growth = cases/lag(cases)) %>%
ungroup(),
aes(x = date, y = growth, color = Country.Region, linetype = type)) +
geom_smooth(alpha = .2) +
facet_wrap(vars(type)) +
coord_cartesian(ylim = c(.5, 3.5)) +
labs(title = 'Smoothed growth ratio',
y = 'Growth ratio')
